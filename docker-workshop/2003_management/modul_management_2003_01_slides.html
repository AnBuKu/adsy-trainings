<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Docker Management</title>

    <link rel="stylesheet" href="../common/reveal.js/css/reveal.css">
    <link rel="stylesheet" href="../common/reveal.js/css/theme/white.css">
    <link rel="stylesheet" href="../common/css/reveal-adsy.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="../common/css/monokai.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? '../common/reveal.js/css/print/pdf.css' : '../common/reveal.js/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
<section><section id="docker-management" class="titleslide slide level1"><h1>Docker Management</h1></section><section id="disclaimer" class="slide level2">
<h1>Disclaimer</h1>
<p>This presentation is geared towards management of development environments. Not all of the recommendations apply for production environments!</p>
</section></section>
<section><section id="docker-volume-management" class="titleslide slide level1"><h1>Docker volume Management</h1></section><section id="automatically-created-volumes" class="slide level2">
<h1>Automatically created volumes</h1>
<p>Docker Engine automatically creates a volume for every <code>VOLUME</code> command in the Dockerfile</p>
<pre class="bash"><code>docker run -d mariadb
docker volume ls</code></pre>
</section><section id="mount-a-host-path-in-the-containers" class="slide level2">
<h1>Mount a host path in the containers</h1>
<p>Volumes can also be paths on the host</p>
<p><strong>Paths specified this way must the absolute paths</strong></p>
<pre class="bash"><code>docker run -d -v &quot;$(pwd)/dockerdata:/var/lib/mysql&quot; --name mariadb mariadb
docker inspect -f &#39;{{ json .Mounts }}&#39; mariadb | jq
[
  {
    &quot;Source&quot;: &quot;/home/lukasgr/Docker_Workshop/dockerdata&quot;,
    &quot;Destination&quot;: &quot;/var/lib/mysql&quot;,
    &quot;Mode&quot;: &quot;&quot;,
    &quot;RW&quot;: true,
    &quot;Propagation&quot;: &quot;rprivate&quot;
  }
]</code></pre>
</section></section>
<section><section id="docker-compose" class="titleslide slide level1"><h1>docker-compose</h1></section><section id="what-is-docker-compose" class="slide level2">
<h1>What is docker-compose</h1>
<p>docker-compose provides a layer of abstraction to avoid running multiple docker commands or using crazy long commands with multiple options</p>
<p>To configure it create a <strong>docker-compose.yml</strong> file in a directory, an example is provided on the next slide</p>
</section><section id="applications-with-docker-compose" class="slide level2">
<h1>Applications with docker-compose</h1>
<p><code>docker-compose</code> allows to combine multiple Docker containers to an application</p>
<pre class="yaml"><code>version: &#39;2&#39;
services:
  db:
    image: mariadb:10.1
    volumes:
      - &quot;./.data/db:/var/lib/mysql&quot;
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: wordpress
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wordpress
      MYSQL_PASSWORD: wordpress

  wordpress:
    depends_on:
      - db
    image: wordpress:latest
    volumes:
      - &quot;./.data/wp-content:/var/www/html/wp-content&quot;
    links:
      - db
    ports:
      - &quot;8000:80&quot;
    restart: always
    environment:
      WORDPRESS_DB_HOST: db:3306
      WORDPRESS_DB_PASSWORD: wordpress</code></pre>
</section><section id="start-you-application-with-docker-compose" class="slide level2">
<h1>Start you application with docker-compose</h1>
<p>Copy the example from the previous slide to <strong>docker-compose.yml</strong> and run</p>
<pre><code>docker-compose up</code></pre>
<p>and open <a href="http://localhost:8000/" class="uri">http://localhost:8000/</a> in your browser</p>
</section></section>
<section><section id="keep-your-environment-clean" class="titleslide slide level1"><h1>Keep your environment clean</h1></section><section id="remove-exited-containers" class="slide level2">
<h1>Remove exited containers</h1>
<p>This command removes all containers in the exited state</p>
<pre class="bash"><code>docker ps -q -f status=exited | xargs -r docker rm -v</code></pre>
</section><section id="remove-dangling-images" class="slide level2">
<h1>Remove dangling images</h1>
<p>This command removes all Docker images which are not part of a Docker layer anymore</p>
<pre class="bash"><code>docker images -q -f dangling=true | xargs -r docker rmi</code></pre>
</section><section id="remove-dangling-volumes" class="slide level2">
<h1>Remove dangling volumes</h1>
<p>This command removes all automatically created volumes which are not attached to a container anymore</p>
<pre class="bash"><code>docker volume ls -q -f dangling=true | xargs -r docker volume rm</code></pre>
</section><section id="update-local-docker-images-to-the-newest-version" class="slide level2">
<h1>Update local Docker images to the newest version</h1>
<p>This command will check for new versions of the each image:tag combination in <code>docker images</code></p>
<pre class="bash"><code>docker images | awk &#39;(NR&gt;1) &amp;&amp; ($2!~/none/) {print $1&quot;:&quot;$2}&#39; | xargs -L 1 docker pull</code></pre>
</section></section>
      </div>
    </div>

    <script src="../common/reveal.js/lib/js/head.min.js"></script>
    <script src="../common/reveal.js/js/reveal.js"></script>

    <script>
      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: false,
        progress: false,
        history: true,
        center: true,

        menu: {
          themes: false,
          transitions: false,
          openButton: false,
          openSlideNumber: true,
          markers: true
        },

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          { src: '../common/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: '../common/reveal.js/plugin/notes/notes.js', async: true },
          { src: '../common/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: '../common/reveal.js-menu/menu.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });
    </script>
  </body>
</html>
