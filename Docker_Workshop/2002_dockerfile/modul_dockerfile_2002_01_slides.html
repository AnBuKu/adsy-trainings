<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Dockerfiles</title>

    <link rel="stylesheet" href="../common/reveal.js/css/reveal.css">
    <link rel="stylesheet" href="../common/reveal.js/css/theme/white.css">
    <link rel="stylesheet" href="../common/css/reveal-adsy.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="../common/css/monokai.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? '../common/reveal.js/css/print/pdf.css' : '../common/reveal.js/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
<section><section id="dockerfiles" class="titleslide slide level1"><h1>Dockerfiles</h1></section><section id="what-is-a-dockerfile" class="slide level2">
<h1>What is a Dockerfile?</h1>
<p>Build instructions for Docker images</p>
<p>Each command creates a layer in the image</p>
<pre class="dockerfile"><code>FROM centos:7
MAINTAINER Foo Bar &lt;foo.bar@example.com&gt;

RUN yum install -y \
      curl \
      gzip \
      tar \
    &amp;&amp; yum clean all

COPY docker-entrypoint.sh /usr/local/bin/

ENTRYPOINT [&quot;docker-entrypoint.sh&quot;]

CMD [&quot;bash&quot;]</code></pre>
</section><section id="docker-build-context" class="slide level2">
<h1>Docker build context</h1>
<p><strong>All</strong> files in the directory where the Dockerfile resides are sent to the Docker daemon as the <strong>build context</strong></p>
<p>To exclude specific files create a <strong>.dockerignore</strong> file</p>
<pre><code># exclude README.md
README.md
# exclude *.pyc files
**/*.pyc</code></pre>
</section><section id="which-commands-are-available" class="slide level2">
<h1>Which commands are available?</h1>
</section><section id="from" class="slide level2">
<h1>FROM</h1>
<p>Build upon this Docker image</p>
<pre class="dockerfile"><code>FROM centos:7</code></pre>
<p><strong>Best Practice:</strong> Always specify a tag!</p>
</section><section id="maintainer" class="slide level2">
<h1>MAINTAINER</h1>
<p>Add maintainer information to your Docker image</p>
<pre class="dockerfile"><code>MAINTAINER Foo Bar &lt;foo.bar@example.com&gt;</code></pre>
</section><section id="run" class="slide level2">
<h1>RUN</h1>
<p>Run a command in the build container</p>
<pre class="dockerfile"><code>RUN yum install -y \
      curl \
      tar \
      gzip \
  &amp;&amp; yum clean all</code></pre>
<p><strong>Best Practice:</strong> Use as few <code>RUN</code> instructions as possible</p>
<p><strong>Best Practice:</strong> Clean up temporary data at the end of <code>RUN</code></p>
</section><section id="run-1" class="slide level2">
<h1>RUN</h1>
<p>Yes this is ugly, but good practice</p>
<pre class="dockerfile"><code>RUN mkdir -p /usr/src/things \
    &amp;&amp; wget http://example.com/big.tar.xz \
    &amp;&amp; tar -xJf big.tar.xz -C /usr/src/things \
    &amp;&amp; make -C /usr/src/things all \
    &amp;&amp; rm -f big.tar.xz</code></pre>
</section><section id="run-2" class="slide level2">
<h1>RUN</h1>
<p>Still ugly, but no <code>rm</code> required</p>
<pre class="dockerfile"><code>RUN mkdir -p /usr/src/things \
    &amp;&amp; curl -SL http://example.com/big.tar.xz \
      | tar -xJC /usr/src/things \
    &amp;&amp; make -C /usr/src/things all</code></pre>
</section><section id="env" class="slide level2">
<h1>ENV</h1>
<p>Set a environment variable used during build and in the running container</p>
<pre class="dockerfile"><code>ENV MARIADB_MAJOR 10.1
ENV MARIADB_VERSION 10.1.17
RUN { echo &#39;[mariadb]&#39;; \
      echo &#39;name = MariaDB&#39;; \
      echo &quot;baseurl = http://yum.mariadb.org/$MARIADB_MAJOR/centos7-amd64&quot;; \
      echo &#39;gpgkey = https://yum.mariadb.org/RPM-GPG-KEY-MariaDB&#39;; \
      echo &#39;gpgcheck = 1&#39;; \
    } &gt; /etc/yum.repos.d/MariaDB.repo
RUN yum install -y \
      MariaDB-server-$MARIADB_VERSION
    &amp;&amp; yum clean all</code></pre>
<p><strong>Best Practice:</strong> Use it to define versions of packages</p>
<p><strong>Best Practice:</strong> Define app behaviour (e.g. PGDATA)</p>
</section><section id="copy" class="slide level2">
<h1>COPY</h1>
<p>Copy a file/dir from the <strong>build context</strong> to the Docker image</p>
<pre class="dockerfile"><code>COPY src /var/www/html/</code></pre>
</section><section id="add" class="slide level2">
<h1>ADD</h1>
<p>Extended variant of <strong>COPY</strong></p>
<p>Able to e.g. extract tar files and fetch remote sources</p>
<pre class="dockerfile"><code>FROM scratch
ADD rootfs.tar.xz /</code></pre>
<p><strong>Best Practice:</strong> Only use it if you really need it</p>
<p>See <a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/#/add-or-copy">ADD or COPY</a> for more information!</p>
</section><section id="expose" class="slide level2">
<h1>EXPOSE</h1>
<p>Mark a local port in the container for external exposure</p>
<pre class="dockerfile"><code>EXPOSE 80 443</code></pre>
<p><strong>Best Practice:</strong> Only expose required ports</p>
</section><section id="volume" class="slide level2">
<h1>VOLUME</h1>
<p>Mark a directory that will contain persistent data</p>
<p>Data in the image will be copied to the volume</p>
<pre class="dockerfile"><code>VOLUME /var/lib/mysql</code></pre>
</section><section id="user" class="slide level2">
<h1>USER</h1>
<p>Execute all following commands as this user</p>
<pre class="dockerfile"><code>USER tomcat</code></pre>
<p><strong>Best Practice:</strong> Avoid switching users multiple times</p>
</section><section id="cmd" class="slide level2">
<h1>CMD</h1>
<p>Command to be run when the container is being started</p>
<pre class="dockerfile"><code>CMD [&quot;apache2&quot;,&quot;-DFOREGROUND&quot;]</code></pre>
<p><strong>Best Practice:</strong> Start the service for service containers, specify a shell for all other purposes</p>
</section><section id="entrypoint" class="slide level2">
<h1>ENTRYPOINT</h1>
<p>Set the main command that the container runs</p>
<p>The command configured in <strong>CMD</strong> will be appended</p>
<pre class="dockerfile"><code>COPY docker-entrypoint.sh /usr/local/bin/
ENTRYPOINT [&quot;docker-entrypoint.sh&quot;]
CMD [&quot;mysqld&quot;]</code></pre>
<p><strong>Best Practices:</strong> Use for wrapper scripts preparing services (MariaDB, PostgreSQL, ...)</p>
<p>For more information see <a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/#/entrypoint">ENTRYPOINT</a></p>
</section><section id="more-questions" class="slide level2">
<h1>More questions?</h1>
<p>See the full documentation at <a href="https://docs.docker.com/engine/reference/builder/" class="uri">https://docs.docker.com/engine/reference/builder/</a></p>
</section></section>
      </div>
    </div>

    <script src="../common/reveal.js/lib/js/head.min.js"></script>
    <script src="../common/reveal.js/js/reveal.js"></script>

    <script>
      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: false,
        progress: false,
        history: true,
        center: true,

        menu: {
          themes: false,
          transitions: false,
          openButton: false,
          openSlideNumber: true,
          markers: true
        },

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          { src: '../common/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: '../common/reveal.js/plugin/notes/notes.js', async: true },
          { src: '../common/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: '../common/reveal.js-menu/menu.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });
    </script>
  </body>
</html>
